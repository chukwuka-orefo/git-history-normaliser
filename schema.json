{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["timestamp", "scope"],
  "properties": {
    "timestamp": {
      "type": "object",
      "additionalProperties": false,
      "required": ["mode"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["author", "commit", "synthetic"]
        }
      }
    },
    "scope": {
      "type": "object",
      "additionalProperties": false,
      "required": ["fraction"],
      "properties": {
        "fraction": {
          "type": "number",
          "minimum": -1.0,
          "maximum": 1.0
        }
      }
    },
    "calendar": {
      "type": "object",
      "additionalProperties": false,
      "required": ["start", "end"],
      "properties": {
        "start": {
          "type": "string",
          "pattern": "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])$"
        },
        "end": {
          "type": "string",
          "pattern": "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])$"
        },
        "timezone": {
          "type": "string"
        }
      }
    },
    "work_patterns": {
      "type": "object",
      "additionalProperties": false,
      "required": ["weekdays", "saturday", "sunday"],
      "properties": {
        "weekdays": { "$ref": "#/definitions/workBlock" },
        "saturday": { "$ref": "#/definitions/workBlock" },
        "sunday": { "$ref": "#/definitions/workBlock" }
      }
    },
    "randomness": {
      "type": "object",
      "additionalProperties": false,
      "required": ["gap_minutes", "seconds"],
      "properties": {
        "seed": {
          "type": ["integer", "null"]
        },
        "gap_minutes": {
          "type": "object",
          "additionalProperties": false,
          "required": ["min", "max"],
          "properties": {
            "min": { "type": "integer", "minimum": 0 },
            "max": { "type": "integer", "minimum": 0 }
          }
        },
        "seconds": {
          "type": "object",
          "additionalProperties": false,
          "required": ["min", "max"],
          "properties": {
            "min": { "type": "integer", "minimum": 0, "maximum": 59 },
            "max": { "type": "integer", "minimum": 0, "maximum": 59 }
          }
        }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "timestamp": {
            "properties": {
              "mode": { "const": "synthetic" }
            }
          }
        }
      },
      "then": {
        "required": ["calendar", "work_patterns", "randomness"]
      },
      "else": {
        "not": {
          "anyOf": [
            { "required": ["calendar"] },
            { "required": ["work_patterns"] },
            { "required": ["randomness"] }
          ]
        }
      }
    }
  ],
  "definitions": {
    "workBlock": {
      "type": "object",
      "additionalProperties": false,
      "required": ["enabled"],
      "properties": {
        "enabled": { "type": "boolean" },
        "hours": {
          "type": "object",
          "additionalProperties": false,
          "required": ["start", "end"],
          "properties": {
            "start": {
              "type": "string",
              "pattern": "^([01]\\d|2[0-3]):[0-5]\\d$"
            },
            "end": {
              "type": "string",
              "pattern": "^([01]\\d|2[0-3]):[0-5]\\d$"
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "enabled": { "const": true } }
          },
          "then": {
            "required": ["hours"]
          },
          "else": {
            "not": { "required": ["hours"] }
          }
        }
      ]
    }
  }
}
